@if (factTypeStore.isReady()) {
  <aw-detail-header
    detailName="Fact Type"
    [inEditMode]="factTypeStore.inEditMode()"
    [inCreateMode]="factTypeStore.inCreateMode()"
    (toggleEditMode)="factTypeStore.toggleEditMode()"
    (delete)="onDelete()"
  ></aw-detail-header>

  <form [formGroup]="factTypeForm">
    @if (factTypeStore.isErrored()) {
      <aw-error-container [errors]="factTypeStore.errors()" />
    }

    <mat-form-field appearance="outline">
      <mat-label>Name</mat-label>
      <input matInput placeholder="Name" formControlName="name" />
      @if (factTypeForm.controls.name.hasError('required')) {
        <mat-error>
          Name is
          <strong>required</strong>
        </mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Key</mat-label>
      <input matInput placeholder="Key" formControlName="key" />
      @if (factTypeForm.controls.key.hasError('pattern')) {
        <mat-error>
          Lowercase alpha-numeric characters, underscores and hyphens
          <strong>only</strong>
        </mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Description</mat-label>
      <input matInput placeholder="Name" formControlName="description" />
    </mat-form-field>

    @if (factTypeStore.dimensionSchemasCopy()) {
      <div class="dimension-schema-header-container">
        <h5 class="card-title">Dimension Schemas</h5>
        <div class="icons-container">
          <button
            mat-button
            type="button"
            (click)="onCreateDimensionSchema()"
            matTooltip="Add new"
            class="table-header-button label-medium font-weight-regular"
            [disabled]="!factTypeStore.inEditMode()"
          >
            <fa-icon
              aria-label="Add new icon button"
              class="table-header-button-icon"
              [icon]="faCirclePlus"
              size="xl"
            ></fa-icon>
            Add Dimension Schema
          </button>
        </div>
      </div>

      <div class="table-container">
        @if (factTypeStore.dimensionSchemasCopy().length > 0) {
          <table
            mat-table
            [dataSource]="factTypeStore.dimensionSchemasCopy() ?? []"
            class="mat-elevation-z0"
          >
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Name</th>
              <td mat-cell *matCellDef="let element">{{ element.name }}</td>
            </ng-container>

            <ng-container matColumnDef="key">
              <th mat-header-cell *matHeaderCellDef>Key</th>
              <td mat-cell *matCellDef="let element">{{ element.key }}</td>
            </ng-container>

            <ng-container matColumnDef="dataType">
              <th mat-header-cell *matHeaderCellDef>Data Type</th>
              <td mat-cell *matCellDef="let element">{{ element.dataType }}</td>
            </ng-container>

            <ng-container matColumnDef="dataUnit">
              <th mat-header-cell *matHeaderCellDef>Data Unit</th>
              <td mat-cell *matCellDef="let element">{{ element.dataUnit }}</td>
            </ng-container>

            <ng-container matColumnDef="isRequired">
              <th mat-header-cell *matHeaderCellDef>Is Required?</th>
              <td mat-cell *matCellDef="let element">
                <mat-checkbox
                  [checked]="element.isRequired"
                  [disabled]="true"
                ></mat-checkbox>
              </td>
            </ng-container>

            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let element; let i = index">
                <div class="actions-icon-container">
                  <button
                    mat-button
                    type="button"
                    (click)="onEditDimensionSchema(i, element)"
                    class="detail-header-button"
                    matTooltip="Edit"
                    [disabled]="!factTypeStore.inEditMode()"
                  >
                    <fa-icon
                      aria-label="Edit icon"
                      [icon]="faPenToSquare"
                      size="xl"
                      class="detail-header-button-icon"
                    ></fa-icon>
                  </button>
                  <button
                    mat-button
                    type="button"
                    (click)="onDeleteDimensionSchema(i)"
                    class="detail-header-button"
                    matTooltip="Delete"
                    [disabled]="!factTypeStore.inEditMode()"
                  >
                    <fa-icon
                      aria-label="Delete icon"
                      [icon]="faTrashCan"
                      size="xl"
                      class="detail-header-button-icon"
                    ></fa-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>
        } @else {
          <aw-no-records-generic
            message="Click Add Dimension Schema button above to add dimension schemas."
          ></aw-no-records-generic>
        }
      </div>
    }

    @if (factTypeStore.inCreateMode()) {
      <aw-tags-form
        [tags]="factTypeStore.tagStrings()"
        (updateTagsForCreate)="updateTagsForCreate($event)"
        [inEditMode]="false"
      ></aw-tags-form>
    }

    <div class="form-button-container">
      <button
        mat-button
        type="button"
        (click)="onCancel()"
        class="default-button"
        [disabled]="!factTypeStore.inEditMode()"
      >
        Cancel
      </button>
      <button
        mat-flat-button
        type="submit"
        class="default-button"
        [disabled]="
          !factTypeStore.inEditMode() ||
          !factTypeForm.valid ||
          !factTypeForm.dirty
        "
      >
        Save
      </button>
    </div>
  </form>

  <!--  Tags Section-->
  @if (!factTypeStore.inCreateMode()) {
    <aw-tags-form
      [tags]="factTypeStore.tagStrings()"
      (saveTags)="onSetTags($event)"
    ></aw-tags-form>
  }
}
